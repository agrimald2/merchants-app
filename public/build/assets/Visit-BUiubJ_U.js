import{_ as v}from"./AdminLayout-By36QJtX.js";import{L as b}from"./LoaderModal-DPVErhA_.js";import{i as x,j as u,o as l,c as m,w as _,a as t,t as d,e as h,h as w,F as y,f,k as L,l as k}from"./app-_BQdblzI.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ResponsiveNavLink-ZcmGZMZz.js";const D={props:["visit"],components:{AdminLayout:v,LoaderModal:b},data(){return{time_passed:0,intervalId:null,photos:[],description:"",isLoading:!1}},created(){this.startTimer()},beforeDestroy(){clearInterval(this.intervalId)},methods:{startTimer(){const i=new Date(this.visit.visit_started_at);this.intervalId=setInterval(()=>{const o=new Date-i;this.time_passed=this.formatTime(o)},1e3)},formatTime(i){const e=Math.floor(i/1e3),o=Math.floor(e/3600),s=Math.floor(e%3600/60),a=e%60;return`${o}h ${s}m ${a}s`},uploadPhoto(i){const e=i.target.files[0];if(e){const o=new FileReader;o.onload=s=>{this.photos.length<4?this.photos.push({url:s.target.result,file:e}):alert("Puedes subir un máximo de 4 fotos.")},o.readAsDataURL(e)}},removePhoto(i){this.photos.splice(i,1)},async endVisit(){navigator.geolocation?navigator.geolocation.getCurrentPosition(async i=>{const{latitude:e,longitude:o}=i.coords;try{this.isLoading=!0;const s=new FormData;s.append("visit_id",this.visit.id),s.append("end_latitude",e),s.append("end_longitude",o),s.append("visit_overview",this.description),this.photos.slice(0,4).forEach((r,c)=>{s.append(`photos[${c}]`,r.file)});const a=await x.post(route("merchant.endVisit"),s,{headers:{"Content-Type":"multipart/form-data"}});console.log("Visita terminada:",a.data),window.location.href=route("merchant.home")}catch(s){console.error("Error terminando la visita:",s)}finally{this.isLoading=!1}},i=>{console.error("Error obteniendo la ubicación:",i)}):console.error("La geolocalización no es soportada por este navegador.")}}},V={class:"font-semibold text-lg text-white leading-tight text-center"},M={class:"text-white text-center"},P={class:"max-w-2xl mx-auto"},T={class:"bg-white p-4"},E={class:"text-center text-red-ac text-2xl font-bold"},F={class:"px-3 pt-6"},A=t("h3",{class:"font-bold subtitles"},"Hora Registrada",-1),B={class:"font-medium"},I={class:"px-3 pt-6"},S=t("h3",{class:"font-bold subtitles"},"Subir Fotos",-1),j={class:"grid grid-cols-2 gap-4"},R=["src"],N=["onClick"],U={key:0,class:"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg h-32"},z=t("span",{class:"text-gray-500"},"+",-1),H={class:"px-3 pt-6"},O=t("h3",{class:"font-bold subtitles"},"Bitácora",-1),q={class:"p-4"};function G(i,e,o,s,a,r){const c=u("LoaderModal"),g=u("AdminLayout");return l(),m(g,{title:"Dashboard"},{header:_(()=>[t("h2",V," En Visita - "+d(o.visit.point_of_sale.name)+" - "+d(o.visit.status),1),t("p",M,d(o.visit.point_of_sale.address),1)]),default:_(()=>[t("div",P,[t("div",T,[t("h3",E,d(a.time_passed),1)]),t("div",F,[A,t("p",B,d(new Date(o.visit.visit_started_at).toLocaleTimeString()),1)]),t("div",I,[S,t("div",j,[(l(!0),h(y,null,w(a.photos,(n,p)=>(l(),h("div",{key:p,class:"relative"},[t("img",{src:n.url,alt:"Foto subida",class:"w-full h-32 object-cover rounded-lg"},null,8,R),t("button",{onClick:J=>r.removePhoto(p),class:"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full"}," × ",8,N)]))),128)),a.photos.length<4?(l(),h("div",U,[t("input",{type:"file",onChange:e[0]||(e[0]=(...n)=>r.uploadPhoto&&r.uploadPhoto(...n)),accept:"image/*",capture:"camera",class:"absolute opacity-0 w-full cursor-pointer",style:{height:"inherit"}},null,32),z])):f("",!0)])]),t("div",H,[O,L(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=n=>a.description=n),class:"w-full p-2 border rounded-lg",rows:"4",placeholder:"Observaciones (opcional)"},`
                `,512),[[k,a.description]])]),t("div",q,[t("button",{type:"submit",onClick:e[2]||(e[2]=(...n)=>r.endVisit&&r.endVisit(...n)),class:"mt-2 bg-red-ac text-white w-full px-4 py-2 rounded-md hover:bg-red-600 transition font-bold"},"Enviar"),t("button",{type:"submit",onClick:e[3]||(e[3]=()=>{}),class:"mt-2 bg-white text-black border border-black w-full px-4 py-2 rounded-md hover:bg-red-600 transition font-bold"},"Cancelar Visita")])]),a.isLoading?(l(),m(c,{key:0})):f("",!0)]),_:1})}const Z=C(D,[["render",G]]);export{Z as default};
