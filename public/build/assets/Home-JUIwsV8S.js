import{_ as f}from"./AdminLayout-DyKJTlMu.js";import{o as i,c as n,w as d,i as r,a as t,t as a,e as c,h,F as g,f as u}from"./app-BR1h8Tyc.js";import m from"./PendingVisitsComponent-D197ErKy.js";import _ from"./DoneVisitsComponent-7360_tve.js";import p from"./ScanQR-DoJNFkmR.js";import"./ResponsiveNavLink-BYFCwL7N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VisitDetailsModal-CiE1LXg3.js";const V={class:"font-semibold text-lg text-white leading-tight text-center"},v={class:"max-w-2xl mx-auto"},x={class:"bg-white p-4"},b={class:"filters"},w={class:"grid grid-cols-3 gap-4 mb-4"},y={class:"bg-red-500 text-white rounded-lg p-4 flex flex-col items-center"},P={class:"text-2xl font-bold"},O=t("div",{class:"text-sm"},"Objetivo",-1),D={class:"bg-green-500 text-white rounded-lg p-4 flex flex-col items-center"},M={class:"text-2xl font-bold"},Q=t("div",{class:"text-sm"},"Realizadas",-1),C={class:"bg-yellow-500 text-white rounded-lg p-4 flex flex-col items-center"},E={class:"text-2xl font-bold"},R=t("div",{class:"text-sm"},"Pendientes",-1),S={class:"px-3 pt-6"},k=t("p",null,"Visitas Pendientes",-1),L={class:"px-3 pt-6"},q=t("p",null,"Visitas Realizadas",-1),I=t("i",{class:"fa-solid fa-qrcode"},null,-1),B=[I],N={components:{DoneVisitsComponent:_,PendingVisitsComponent:m,ScanQR:p},data(){return{isQRModalVisible:!1,pendingVisits:[],doneVisits:[],isOnVisit:null}},computed:{totalVisits(){return this.pendingVisits.length+this.doneVisits.length}},created(){this.fetchPendingVisits(),this.fetchDoneVisits(),this.fetchIsOnVisit()},methods:{toggleQrModal(){this.isQRModalVisible=!this.isQRModalVisible},async fetchPendingVisits(){try{const s=await r.get(route("merchant.pendingVisits"));this.pendingVisits=s.data}catch(s){console.error("Error fetching pending visits:",s)}},async fetchDoneVisits(){try{const s=await r.get(route("merchant.doneVisits"));this.doneVisits=s.data}catch(s){console.error("Error fetching done visits:",s)}},async fetchIsOnVisit(){try{const s=await r.post(route("merchant.isOnVisit"));this.isOnVisit=s.data.visit,console.log(s.data),s.data.isOnVisit&&(window.location.href=route("merchant.view.visit",{id:this.isOnVisit.id}))}catch(s){console.error("Error fetching is on visit:",s)}},requestLocationPermission(){navigator.geolocation?navigator.geolocation.getCurrentPosition(()=>{this.toggleQrModal()},s=>{s.code===s.PERMISSION_DENIED&&alert("Location permission is required to start a visit. Please enable location services.")}):alert("Geolocation is not supported by this browser.")}}},K=Object.assign(N,{__name:"Home",setup(s){return(e,l)=>(i(),n(f,{title:"Dashboard"},{header:d(()=>[t("h2",V,a(new Date().toLocaleDateString("es-ES",{weekday:"long",month:"long",day:"numeric"})),1)]),default:d(()=>[t("div",v,[t("div",x,[t("div",b,[t("div",w,[t("div",y,[t("div",P,a(e.totalVisits),1),O]),t("div",D,[t("div",M,a(e.doneVisits.length),1),Q]),t("div",C,[t("div",E,a(e.pendingVisits.length),1),R])])])]),t("div",S,[k,(i(!0),c(g,null,h(e.pendingVisits,o=>(i(),n(m,{visit:o,onScan:e.toggleQrModal},null,8,["visit","onScan"]))),256))]),t("div",L,[q,(i(!0),c(g,null,h(e.doneVisits,o=>(i(),n(_,{visit:o},null,8,["visit"]))),256))]),t("button",{onClick:l[0]||(l[0]=(...o)=>e.requestLocationPermission&&e.requestLocationPermission(...o)),class:"fixed bottom-4 right-4 bg-red-500 text-white p-4 rounded-full shadow-lg flex items-center justify-center"},B)]),e.isQRModalVisible?(i(),n(p,{key:0,onClose:e.toggleQrModal},null,8,["onClose"])):u("",!0)]),_:1}))}});export{K as default};
