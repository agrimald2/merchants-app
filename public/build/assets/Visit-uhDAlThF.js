import{_ as v}from"./AdminLayout-CN6NgqNZ.js";import{L as b}from"./LoaderModal-25VVEvSX.js";import{i as w,j as u,o as l,c as m,w as _,a as t,t as d,e as h,h as x,F as y,f,k as L,l as k}from"./app-CxrSCD6l.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ResponsiveNavLink-BlnKUect.js";const D={props:["visit"],components:{AdminLayout:v,LoaderModal:b},data(){return{time_passed:0,intervalId:null,photos:[],description:"",isLoading:!1}},created(){this.startTimer()},beforeDestroy(){clearInterval(this.intervalId)},methods:{startTimer(){const s=new Date(this.visit.visit_started_at);this.intervalId=setInterval(()=>{const i=new Date-s;this.time_passed=this.formatTime(i)},1e3)},formatTime(s){const e=Math.floor(s/1e3),i=Math.floor(e/3600),o=Math.floor(e%3600/60),a=e%60;return`${i}h ${o}m ${a}s`},uploadPhoto(s){const e=s.target.files[0];if(e){const i=new FileReader;i.onload=o=>{this.photos.length<4?this.photos.push({url:o.target.result,file:e}):alert("You can upload a maximum of 4 photos.")},i.readAsDataURL(e)}},removePhoto(s){this.photos.splice(s,1)},async endVisit(){navigator.geolocation?navigator.geolocation.getCurrentPosition(async s=>{const{latitude:e,longitude:i}=s.coords;try{this.isLoading=!0;const o=new FormData;o.append("visit_id",this.visit.id),o.append("end_latitude",e),o.append("end_longitude",i),o.append("visit_overview",this.description),this.photos.slice(0,4).forEach((r,c)=>{o.append(`photos[${c}]`,r.file)});const a=await w.post(route("merchant.endVisit"),o,{headers:{"Content-Type":"multipart/form-data"}});console.log("Visit ended:",a.data),window.location.href=route("merchant.home")}catch(o){console.error("Error ending visit:",o)}finally{this.isLoading=!1}},s=>{console.error("Error getting location:",s)}):console.error("Geolocation is not supported by this browser.")}}},V={class:"font-semibold text-lg text-white leading-tight text-center"},M={class:"max-w-2xl mx-auto"},T={class:"bg-white p-4"},E={class:"text-center text-red-ac text-2xl font-bold"},P={class:"px-3 pt-6"},A=t("h3",{class:"font-bold subtitles"},"Hora Registrada",-1),B={class:"font-medium"},F={class:"px-3 pt-6"},I=t("h3",{class:"font-bold subtitles"},"Subir Fotos",-1),S={class:"grid grid-cols-2 gap-4"},j=["src"],R=["onClick"],U={key:0,class:"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg h-32"},N=t("span",{class:"text-gray-500"},"+",-1),G={class:"px-3 pt-6"},H=t("h3",{class:"font-bold subtitles"},"Bitácora",-1),O={class:"p-4"};function Y(s,e,i,o,a,r){const c=u("LoaderModal"),g=u("AdminLayout");return l(),m(g,{title:"Dashboard"},{header:_(()=>[t("h2",V," En Visita - "+d(i.visit.point_of_sale.name)+" - "+d(i.visit.status),1)]),default:_(()=>[t("div",M,[t("div",T,[t("h3",E,d(a.time_passed),1)]),t("div",P,[A,t("p",B,d(new Date(i.visit.visit_started_at).toLocaleTimeString()),1)]),t("div",F,[I,t("div",S,[(l(!0),h(y,null,x(a.photos,(n,p)=>(l(),h("div",{key:p,class:"relative"},[t("img",{src:n.url,alt:"Uploaded photo",class:"w-full h-32 object-cover rounded-lg"},null,8,j),t("button",{onClick:q=>r.removePhoto(p),class:"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full"}," × ",8,R)]))),128)),a.photos.length<4?(l(),h("div",U,[t("input",{type:"file",onChange:e[0]||(e[0]=(...n)=>r.uploadPhoto&&r.uploadPhoto(...n)),accept:"image/*",capture:"camera",class:"absolute opacity-0 w-full cursor-pointer",style:{height:"inherit"}},null,32),N])):f("",!0)])]),t("div",G,[H,L(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=n=>a.description=n),class:"w-full p-2 border rounded-lg",rows:"4",placeholder:"Observaciones (opcional)"},`\r
        `,512),[[k,a.description]])]),t("div",O,[t("button",{type:"submit",onClick:e[2]||(e[2]=(...n)=>r.endVisit&&r.endVisit(...n)),class:"mt-2 bg-red-ac text-white w-full px-4 py-2 rounded-md hover:bg-red-600 transition font-bold"},"Enviar"),t("button",{type:"submit",onClick:e[3]||(e[3]=()=>{}),class:"mt-2 bg-white text-black border border-black w-full px-4 py-2 rounded-md hover:bg-red-600 transition font-bold"},"Cancelar Visita")])]),a.isLoading?(l(),m(c,{key:0})):f("",!0)]),_:1})}const X=C(D,[["render",Y]]);export{X as default};
