import{_ as m}from"./AdminLayout-DISqWOtQ.js";import{i as _,j as f,o as l,c as v,w as u,a as t,t as d,e as h,h as g,F as b,f as w,k as x,l as y}from"./app-U5YtH81c.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ResponsiveNavLink-CK2DDaeU.js";const C={props:["visit"],components:{AdminLayout:m},data(){return{time_passed:0,intervalId:null,photos:[],description:""}},created(){this.startTimer()},beforeDestroy(){clearInterval(this.intervalId)},methods:{startTimer(){const s=new Date(this.visit.visit_started_at);this.intervalId=setInterval(()=>{const i=new Date-s;this.time_passed=this.formatTime(i)},1e3)},formatTime(s){const e=Math.floor(s/1e3),i=Math.floor(e/3600),o=Math.floor(e%3600/60),r=e%60;return`${i}h ${o}m ${r}s`},uploadPhoto(s){const e=s.target.files[0];if(e){const i=new FileReader;i.onload=o=>{this.photos.length<4?this.photos.push({url:o.target.result,file:e}):alert("You can upload a maximum of 4 photos.")},i.readAsDataURL(e)}},removePhoto(s){this.photos.splice(s,1)},async endVisit(){navigator.geolocation?navigator.geolocation.getCurrentPosition(async s=>{const{latitude:e,longitude:i}=s.coords;try{const o=new FormData;o.append("visit_id",this.visit.id),o.append("end_latitude",e),o.append("end_longitude",i),o.append("visit_overview",this.description),this.photos.slice(0,4).forEach((a,c)=>{o.append(`photos[${c}]`,a.file)});const r=await _.post(route("merchant.endVisit"),o,{headers:{"Content-Type":"multipart/form-data"}});console.log("Visit ended:",r.data),window.location.href=route("merchant.home")}catch(o){console.error("Error ending visit:",o)}},s=>{console.error("Error getting location:",s)}):console.error("Geolocation is not supported by this browser.")}}},D={class:"font-semibold text-lg text-white leading-tight text-center"},V={class:"max-w-2xl mx-auto"},T={class:"bg-white p-4"},E={class:"text-center text-red-ac text-2xl font-bold"},L={class:"px-3 pt-6"},P=t("h3",{class:"font-bold subtitles"},"Hora Registrada",-1),A={class:"font-medium"},B={class:"px-3 pt-6"},F=t("h3",{class:"font-bold subtitles"},"Subir Fotos",-1),I={class:"grid grid-cols-2 gap-4"},S=["src"],M=["onClick"],j={key:0,class:"flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg h-32"},R=t("span",{class:"text-gray-500"},"+",-1),U={class:"px-3 pt-6"},N=t("h3",{class:"font-bold subtitles"},"Bitácora",-1),G={class:"p-4"};function H(s,e,i,o,r,a){const c=f("AdminLayout");return l(),v(c,{title:"Dashboard"},{header:u(()=>[t("h2",D," En Visita - "+d(i.visit.point_of_sale.name)+" - "+d(i.visit.status),1)]),default:u(()=>[t("div",V,[t("div",T,[t("h3",E,d(r.time_passed),1)]),t("div",L,[P,t("p",A,d(new Date(i.visit.visit_started_at).toLocaleTimeString()),1)]),t("div",B,[F,t("div",I,[(l(!0),h(b,null,g(r.photos,(n,p)=>(l(),h("div",{key:p,class:"relative"},[t("img",{src:n.url,alt:"Uploaded photo",class:"w-full h-32 object-cover rounded-lg"},null,8,S),t("button",{onClick:O=>a.removePhoto(p),class:"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full"}," × ",8,M)]))),128)),r.photos.length<4?(l(),h("div",j,[t("input",{type:"file",onChange:e[0]||(e[0]=(...n)=>a.uploadPhoto&&a.uploadPhoto(...n)),accept:"image/*",capture:"camera",class:"absolute opacity-0 w-full cursor-pointer",style:{height:"inherit"}},null,32),R])):w("",!0)])]),t("div",U,[N,x(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=n=>r.description=n),class:"w-full p-2 border rounded-lg",rows:"4",placeholder:"Observaciones (opcional)"},`\r
        `,512),[[y,r.description]])]),t("div",G,[t("button",{type:"submit",onClick:e[2]||(e[2]=(...n)=>a.endVisit&&a.endVisit(...n)),class:"mt-2 bg-red-ac text-white w-full px-4 py-2 rounded-md hover:bg-red-600 transition font-bold"},"Enviar"),t("button",{type:"submit",onClick:e[3]||(e[3]=()=>{}),class:"mt-2 bg-white text-black border border-black w-full px-4 py-2 rounded-md hover:bg-red-600 transition font-bold"},"Cancelar Visita")])])]),_:1})}const K=k(C,[["render",H]]);export{K as default};
