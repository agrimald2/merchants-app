import{_ as M}from"./AdminLayout-By36QJtX.js";import b from"./MerchantProgressComponent-D6Eg3lVL.js";import y from"./AddManualVisit-HUUL0BCA.js";import{i as a,j as c,o as n,c as f,w as u,a as t,k as d,v as p,e as l,h,t as v,F as g,l as P,b as L}from"./app-_BQdblzI.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ResponsiveNavLink-ZcmGZMZz.js";import"./LoaderModal-DPVErhA_.js";const k={components:{AdminLayout:M,MerchantProgressComponent:b,AddManualVisit:y},props:["visits"],data(){return{regions:[],locations:[],filteredLocations:[],merchants:[],filteredMerchants:[],merchantProgresses:[],selectedRegion:"",selectedLocation:"",selectedMerchant:"",selectedDate:new Date().toISOString().substr(0,10),averageProgress:0,showModal:!1}},mounted(){this.getRegions(),this.getLocations(),this.getMerchants(),this.getMerchantProgresses()},methods:{async getRegions(){try{const e=await a.get("/api/regions");this.regions=e.data}catch(e){console.error("Error fetching regions:",e)}},async getLocations(){try{const e=await a.get("/api/locations");this.locations=e.data,this.filteredLocations=this.locations}catch(e){console.error("Error fetching locations:",e)}},async getMerchants(){try{const e=await a.get("/admin/merchants/all");this.merchants=e.data,this.filteredMerchants=this.merchants}catch(e){console.error("Error fetching merchants:",e)}},async getMerchantProgresses(){try{const e=await a.get(`/admin/generalVisitProgress/${this.selectedDate}`);this.merchantProgresses=e.data,this.calculateAverageProgress()}catch(e){console.error("Error fetching merchant progresses:",e)}},async filterData(){console.log("Hola"),console.log(this.selectedMerchant);try{const e=await a.get(`/admin/generalVisitProgress/${this.selectedDate}`,{params:{region_id:this.selectedRegion,location_id:this.selectedLocation,merchant_id:this.selectedMerchant}});this.merchantProgresses=e.data,this.calculateAverageProgress()}catch(e){console.error("Error filtering data:",e)}},filterLocations(){this.selectedRegion?this.filteredLocations=this.locations.filter(e=>e.region_id===this.selectedRegion):this.filteredLocations=this.locations,this.filterMerchants()},filterMerchants(){this.selectedLocation?this.filteredMerchants=this.merchants.filter(e=>e.location.id===this.selectedLocation):this.filteredMerchants=this.merchants,this.filterData()},calculateAverageProgress(){if(this.merchantProgresses.length>0){const e=this.merchantProgresses.reduce((o,m)=>o+m.progress,0);this.averageProgress=(e/this.merchantProgresses.length).toFixed(2)}else this.averageProgress=0},addNewItem(){this.showModal=!0},async handleSaveVisit(e){try{await a.post("/admin/assignMerchantVisitManual",e),this.showModal=!1,this.getMerchantProgresses()}catch(o){console.error("Error saving visit:",o)}}}},D=t("h2",{class:"font-semibold text-lg text-white leading-tight text-center"}," Visitas ",-1),C={class:"bg-white p-4 max-w-3xl mx-auto"},A={class:"filters"},E={class:"grid grid-cols-1 gap-4 mb-4"},S=t("label",{for:"location",class:"block text-sm font-medium text-gray-700"},"LocaciÃ³n",-1),R=t("option",{value:""},"Todos",-1),j=["value"],B={class:"mb-4"},N=t("label",{for:"merchant",class:"block text-sm font-medium text-gray-700"},"Seleccionar Mercaderista",-1),I=t("option",{value:""},"Todos",-1),F=["value"],O=t("label",{for:"date",class:"block text-sm font-medium text-gray-700"},"Elige una fecha",-1),T={class:"mt-1 relative rounded-md shadow-sm"},U=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-4 14h.01M12 21v-5m0 0H9m3 0h3m-3 0V3m0 16h.01M8 7V3m8 4V3m-4 14h.01"})])],-1),H={class:"mt-4 flex justify-end"},q=t("i",{class:"fa-solid fa-plus"},null,-1),z=[q],G={class:"px-3 pt-2 max-w-3xl mx-auto"},J=t("div",{class:"bg-white pt-2 pb-2 px-3 rounded-lg shadow-md flex items-center justify-between space-x-4 my-3 w-full"},[t("div",{class:"grid grid-cols-8 w-full py-1"},[t("div",{class:"col-span-4 text-left font-bold text-red-800 text-lg"}," Mercaderista "),t("div",{class:"col-span-2 text-left font-bold text-red-800 text-lg"}," Objetivo "),t("div",{class:"col-span-2 text-left font-bold text-red-800 text-lg"}," Avance ")])],-1);function K(e,o,m,Q,r,i){const x=c("AddManualVisit"),_=c("MerchantProgressComponent"),w=c("AdminLayout");return n(),f(w,{title:"Dashboard"},{header:u(()=>[D]),default:u(()=>[t("div",C,[t("div",A,[t("div",E,[t("div",null,[S,d(t("select",{id:"location","onUpdate:modelValue":o[0]||(o[0]=s=>r.selectedLocation=s),onChange:o[1]||(o[1]=(...s)=>i.filterLocations&&i.filterLocations(...s)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[R,(n(!0),l(g,null,h(r.filteredLocations,s=>(n(),l("option",{key:s.id,value:s.id},v(s.name),9,j))),128))],544),[[p,r.selectedLocation]])])]),t("div",B,[N,d(t("select",{id:"merchant","onUpdate:modelValue":o[2]||(o[2]=s=>r.selectedMerchant=s),onChange:o[3]||(o[3]=(...s)=>i.filterData&&i.filterData(...s)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[I,(n(!0),l(g,null,h(r.filteredMerchants,s=>(n(),l("option",{key:s.id,value:s.id},v(s.name),9,F))),128))],544),[[p,r.selectedMerchant]])]),t("div",null,[O,t("div",T,[U,d(t("input",{type:"date",id:"date","onUpdate:modelValue":o[4]||(o[4]=s=>r.selectedDate=s),onChange:o[5]||(o[5]=(...s)=>i.filterData&&i.filterData(...s)),class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Elige una fecha"},null,544),[[P,r.selectedDate]])])]),t("div",H,[t("button",{onClick:o[6]||(o[6]=(...s)=>i.addNewItem&&i.addNewItem(...s)),class:"bg-green-500 text-white px-2 py-1 rounded-full"},z)])])]),t("div",G,[L(x,{showModal:r.showModal,onClose:o[7]||(o[7]=s=>r.showModal=!1),onSave:i.handleSaveVisit},null,8,["showModal","onSave"]),J,(n(!0),l(g,null,h(r.merchantProgresses,s=>(n(),f(_,{key:s.merchant_id,merchantProgress:s,date:r.selectedDate},null,8,["merchantProgress","date"]))),128))])]),_:1})}const se=V(k,[["render",K]]);export{se as default};
