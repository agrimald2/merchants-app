import{_ as C}from"./AdminLayout-CN6NgqNZ.js";import L from"./AddMerchantModal-L-rpmRzp.js";import A from"./MerchantDetailsModal-DyWR7Yjk.js";import D from"./RemoveMerchantModal-C2pCEMny.js";import{L as E}from"./LoaderModal-25VVEvSX.js";import{i as u,j as _,o as a,c as x,w as b,a as e,k as f,v as y,e as d,h as g,t as r,F as m,l as I,g as p,x as N,n as R,f as v}from"./app-CxrSCD6l.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ResponsiveNavLink-BlnKUect.js";const B={components:{AdminLayout:C,AddMerchantModal:L,MerchantDetailsModal:A,RemoveMerchantModal:D,LoaderModal:E},data(){return{merchants:[],filteredMerchants:[],showAddModal:!1,showDetailsModal:!1,showRemoveModal:!1,newMerchant:{name:"",username:"",dni:"",phone:""},selectedMerchant:null,regions:[],locations:[],selectedRegion:"",selectedLocation:"",searchQuery:"",loading:!1}},mounted(){this.fetchMerchants(),this.getRegions(),this.getLocations()},methods:{goBack(){this.$inertia.get(route("admin.uploadData"))},fetchMerchants(){this.loading=!0,u.get("/admin/merchants/all").then(l=>{this.merchants=l.data,this.filterMerchants()}).catch(l=>{console.error("Error fetching merchants:",l)}).finally(()=>{this.loading=!1})},viewDetails(l){this.selectedMerchant=l,this.showDetailsModal=!0},async getRegions(){this.loading=!0;try{const l=await u.get("/api/regions");this.regions=l.data}catch(l){console.error("Error fetching regions:",l)}finally{this.loading=!1}},async getLocations(){this.loading=!0;try{const l=await u.get("/api/locations");this.locations=l.data}catch(l){console.error("Error fetching locations:",l)}finally{this.loading=!1}},filterMerchants(){this.filteredMerchants=this.merchants.filter(l=>{const s=this.selectedRegion?l.location.sub_region.region.id===this.selectedRegion:!0,c=this.selectedLocation?l.location.id===this.selectedLocation:!0,i=this.searchQuery?l.name.toLowerCase().includes(this.searchQuery.toLowerCase())||l.dni.includes(this.searchQuery):!0;return s&&c&&i})},triggerFileInput(){this.$refs.fileInput.click()},handleFileUpload(l){const s=l.target.files[0];if(s){const c=new FormData;c.append("file",s),this.loading=!0,u.post("/admin/merchants/upload",c,{headers:{"Content-Type":"multipart/form-data"}}).then(i=>{if(this.fetchMerchants(),i.data.errors&&i.data.errors.length>0){let n=i.data.errors.map(o=>`DNI: ${o.dni}, Nombre: ${o.name}, Mensaje: ${o.text}`).join(`
`);alert(`Errores al subir el archivo:
${n}`)}else alert("Archivo subido exitosamente")}).catch(i=>{console.error("Error uploading file:",i),alert("Error al subir el archivo")}).finally(()=>{this.loading=!1})}},exportToExcel(){const l=this.filteredMerchants.map(o=>({Name:o.name,DNI:o.dni,Phone:o.phone,Location:o.location.name}));let s="\uFEFF";s+=`Nombre,DNI,Celular,Locaci贸n
`,l.forEach(o=>{s+=`${o.Name},${o.DNI},${o.Phone},${o.Location}
`});const c=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),n=URL.createObjectURL(c);i.setAttribute("href",n),i.setAttribute("download","lista_mercaderistas.csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},U={class:"flex items-center justify-between w-full"},T=e("i",{class:"fa-solid fa-circle-chevron-left"},null,-1),V=[T],j=e("h2",{class:"font-semibold text-lg text-white leading-tight mx-auto"}," Mercaderistas ",-1),Q=e("div",{class:"w-8"},null,-1),S={class:"max-w-3xl mx-auto p-4"},O={class:"bg-white p-4 mb-2"},P={class:"filters"},z={class:"grid grid-cols-2 gap-4 mb-4"},q=e("label",{for:"region",class:"block text-sm font-medium text-gray-700"},"Regi贸n",-1),G=e("option",{value:""},"Todos",-1),H=["value"],J=e("label",{for:"location",class:"block text-sm font-medium text-gray-700"},"Locaci贸n",-1),K=e("option",{value:""},"Todos",-1),W=["value"],X={class:"mb-4"},Y=e("label",{for:"merchantSearch",class:"block text-sm font-medium text-gray-700"},"Buscar Mercaderista",-1),Z={class:"grid grid-cols-2 sm:grid-cols-2 gap-4"},$=e("i",{class:"fa-solid fa-file-excel mr-2"},null,-1),ee=e("i",{class:"fa-solid fa-file-excel mr-2"},null,-1),te={class:"overflow-x-auto hidden lg:block"},se={class:"min-w-full bg-white shadow-md rounded-lg overflow-hidden"},oe=e("thead",{class:"bg-gray-200"},[e("tr",null,[e("th",{class:"py-3 px-4 text-left"},"Name"),e("th",{class:"py-3 px-4 text-left"},"DNI"),e("th",{class:"py-3 px-4 text-left"},"Celular"),e("th",{class:"py-3 px-4 text-left"},"Locaci贸n"),e("th",{class:"py-3 px-4 text-left"},"On/Off")])],-1),le={class:"py-3 px-4"},ne={class:"py-3 px-4"},ie={class:"py-3 px-4"},ae={class:"py-3 px-4"},re={class:"py-3 px-4 flex space-x-2"},de={class:"inline-flex items-center cursor-pointer"},ce=["onUpdate:modelValue","onChange"],he={class:"relative"},ue=e("span",{class:"block w-10 h-6 bg-gray-300 rounded-full shadow-inner"},null,-1),fe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 lg:hidden"},ge={class:"flex items-center justify-between"},me={class:"text-lg font-semibold"},pe={class:"flex space-x-2"},_e=["onClick"],xe=e("i",{class:"fa-solid fa-circle-info"},null,-1),be=[xe],ye=["onClick"],ve=e("i",{class:"fa-solid fa-circle-minus"},null,-1),Me=[ve],we={class:"text-sm text-gray-700"},ke=e("strong",null,"Loc:",-1),Ce=e("strong",null,"Phone:",-1);function Le(l,s,c,i,n,o){const M=_("AddMerchantModal"),w=_("LoaderModal"),k=_("AdminLayout");return a(),x(k,{title:"Mercaderistas"},{header:b(()=>[e("div",U,[e("button",{onClick:s[0]||(s[0]=(...t)=>o.goBack&&o.goBack(...t)),class:"text-white"},V),j,Q])]),default:b(()=>[e("div",S,[e("div",O,[e("div",P,[e("div",z,[e("div",null,[q,f(e("select",{id:"region","onUpdate:modelValue":s[1]||(s[1]=t=>n.selectedRegion=t),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:s[2]||(s[2]=(...t)=>o.filterMerchants&&o.filterMerchants(...t))},[G,(a(!0),d(m,null,g(n.regions,t=>(a(),d("option",{key:t.id,value:t.id},r(t.name),9,H))),128))],544),[[y,n.selectedRegion]])]),e("div",null,[J,f(e("select",{id:"location","onUpdate:modelValue":s[3]||(s[3]=t=>n.selectedLocation=t),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:s[4]||(s[4]=(...t)=>o.filterMerchants&&o.filterMerchants(...t))},[K,(a(!0),d(m,null,g(n.locations,t=>(a(),d("option",{key:t.id,value:t.id},r(t.name),9,W))),128))],544),[[y,n.selectedLocation]])])]),e("div",X,[Y,f(e("input",{type:"text",id:"merchantSearch","onUpdate:modelValue":s[5]||(s[5]=t=>n.searchQuery=t),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",placeholder:"Buscar por nombre o DNI",onInput:s[6]||(s[6]=(...t)=>o.filterMerchants&&o.filterMerchants(...t))},null,544),[[I,n.searchQuery]])]),e("div",Z,[e("div",null,[e("button",{class:"bg-blue-500 text-white px-5 py-1 rounded-md inline-flex items-center w-full font-bold",onClick:s[7]||(s[7]=(...t)=>o.exportToExcel&&o.exportToExcel(...t))},[$,p(" Exportar Excel ")])]),e("div",null,[e("input",{type:"file",ref:"fileInput",onChange:s[8]||(s[8]=(...t)=>o.handleFileUpload&&o.handleFileUpload(...t)),class:"hidden"},null,544),e("button",{class:"bg-green-700 text-white px-5 py-1 rounded-md inline-flex items-center w-full font-bold",onClick:s[9]||(s[9]=(...t)=>o.triggerFileInput&&o.triggerFileInput(...t))},[ee,p(" Importar Excel ")])])])])]),e("div",te,[e("table",se,[oe,e("tbody",null,[(a(!0),d(m,null,g(n.filteredMerchants,t=>(a(),d("tr",{key:t.id,class:"border-b hover:bg-gray-100"},[e("td",le,r(t.name),1),e("td",ne,r(t.dni),1),e("td",ie,r(t.phone),1),e("td",ae,r(t.location.name),1),e("td",re,[e("label",de,[f(e("input",{type:"checkbox","onUpdate:modelValue":h=>t.isActive=h,onChange:h=>l.toggleMerchantStatus(t),class:"sr-only"},null,40,ce),[[N,t.isActive]]),e("span",he,[ue,e("span",{class:R([{"translate-x-4":t.isActive,"translate-x-0":!t.isActive},"absolute block w-4 h-4 mt-1 ml-1 transform bg-white rounded-full shadow inset-y-0 left-0 transition-transform duration-200 ease-in-out"])},null,2)])])])]))),128))])])]),e("div",fe,[(a(!0),d(m,null,g(n.filteredMerchants,t=>(a(),d("div",{key:t.id,class:"bg-white shadow-md rounded-lg p-4"},[e("div",ge,[e("h3",me,r(t.name)+" - "+r(t.dni),1),e("div",pe,[e("button",{onClick:h=>o.viewDetails(t),class:"bg-green-500 text-white px-3 py-1 rounded-md hover:bg-green-600 transition"},be,8,_e),e("button",{onClick:h=>l.confirmRemove(t),class:"bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-600 transition"},Me,8,ye)])]),e("div",we,[e("p",null,[ke,p(" "+r(t.location.name),1)]),e("p",null,[Ce,p(" "+r(t.phone),1)])])]))),128))])]),n.showAddModal?(a(),x(M,{key:0,locations:n.locations,onCloseAddMerchantModal:s[10]||(s[10]=t=>n.showAddModal=!1)},null,8,["locations"])):v("",!0),n.loading?(a(),x(w,{key:1})):v("",!0)]),_:1})}const Ue=F(B,[["render",Le]]);export{Ue as default};
