import{_ as b}from"./AdminLayout-DISqWOtQ.js";import y from"./MerchantProgressComponent-CtFcEfmH.js";import M from"./AddManualVisit-SR1SJez6.js";import{i as l,j as h,o as i,c as p,w as v,a as t,k as d,v as m,e as a,h as c,t as u,F as g,l as P,b as k}from"./app-U5YtH81c.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ResponsiveNavLink-CK2DDaeU.js";import"./LoaderModal-BlvZehoS.js";const D={components:{AdminLayout:b,MerchantProgressComponent:y,AddManualVisit:M},props:["visits"],data(){return{regions:[],locations:[],filteredLocations:[],merchants:[],merchantProgresses:[],selectedRegion:"",selectedLocation:"",selectedMerchant:"",selectedDate:new Date().toISOString().substr(0,10),averageProgress:0,showModal:!1}},mounted(){this.getRegions(),this.getLocations(),this.getMerchants(),this.getMerchantProgresses()},methods:{async getRegions(){try{const s=await l.get("/api/regions");this.regions=s.data}catch(s){console.error("Error fetching regions:",s)}},async getLocations(){try{const s=await l.get("/api/locations");this.locations=s.data,this.filteredLocations=this.locations}catch(s){console.error("Error fetching locations:",s)}},async getMerchants(){try{const s=await l.get("/admin/merchants/all");this.merchants=s.data}catch(s){console.error("Error fetching merchants:",s)}},async getMerchantProgresses(){try{const s=await l.get(`/admin/generalVisitProgress/${this.selectedDate}`);this.merchantProgresses=s.data,this.calculateAverageProgress()}catch(s){console.error("Error fetching merchant progresses:",s)}},async filterData(){try{const s=await l.get(`/admin/generalVisitProgress/${this.selectedDate}`,{params:{region_id:this.selectedRegion,location_id:this.selectedLocation,merchant_id:this.selectedMerchant}});this.merchantProgresses=s.data,this.calculateAverageProgress()}catch(s){console.error("Error filtering data:",s)}},filterLocations(){this.selectedRegion?this.filteredLocations=this.locations.filter(s=>s.region_id===this.selectedRegion):this.filteredLocations=this.locations},calculateAverageProgress(){if(this.merchantProgresses.length>0){const s=this.merchantProgresses.reduce((o,f)=>o+f.progress,0);this.averageProgress=(s/this.merchantProgresses.length).toFixed(2)}else this.averageProgress=0},addNewItem(){this.showModal=!0},async handleSaveVisit(s){try{await l.post("/admin/assignMerchantVisitManual",s),this.showModal=!1,this.getMerchantProgresses()}catch(o){console.error("Error saving visit:",o)}}}},L=t("h2",{class:"font-semibold text-lg text-white leading-tight text-center"}," Visitas ",-1),C={class:"bg-white p-4 max-w-3xl mx-auto"},A={class:"filters"},E={class:"grid grid-cols-2 gap-4 mb-4"},R=t("label",{for:"region",class:"block text-sm font-medium text-gray-700"},"Región",-1),S=t("option",{value:""},"Todos",-1),j=["value"],B=t("label",{for:"location",class:"block text-sm font-medium text-gray-700"},"Locación",-1),N=t("option",{value:""},"Todos",-1),I=["value"],T={class:"mb-4"},U=t("label",{for:"merchant",class:"block text-sm font-medium text-gray-700"},"Seleccionar Mercaderista",-1),F=t("option",{value:""},"Todos",-1),O=["value"],H=t("label",{for:"date",class:"block text-sm font-medium text-gray-700"},"Elige una fecha",-1),q={class:"mt-1 relative rounded-md shadow-sm"},z=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-4 14h.01M12 21v-5m0 0H9m3 0h3m-3 0V3m0 16h.01M8 7V3m8 4V3m-4 14h.01"})])],-1),G={class:"mt-4 flex justify-end"},J=t("i",{class:"fa-solid fa-plus"},null,-1),K=[J],Q={class:"px-3 pt-2 max-w-3xl mx-auto"},W=t("div",{class:"bg-white pt-2 pb-2 px-3 rounded-lg shadow-md flex items-center justify-between space-x-4 my-3 w-full"},[t("div",{class:"grid grid-cols-8 w-full py-1"},[t("div",{class:"col-span-4 text-left font-bold text-red-800 text-lg"}," Mercaderista "),t("div",{class:"col-span-2 text-left font-bold text-red-800 text-lg"}," Objetivo "),t("div",{class:"col-span-2 text-left font-bold text-red-800 text-lg"}," Avance ")])],-1);function X(s,o,f,Y,r,n){const x=h("AddManualVisit"),_=h("MerchantProgressComponent"),w=h("AdminLayout");return i(),p(w,{title:"Dashboard"},{header:v(()=>[L]),default:v(()=>[t("div",C,[t("div",A,[t("div",E,[t("div",null,[R,d(t("select",{id:"region","onUpdate:modelValue":o[0]||(o[0]=e=>r.selectedRegion=e),onChange:o[1]||(o[1]=e=>{n.filterData,n.filterLocations}),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[S,(i(!0),a(g,null,c(r.regions,e=>(i(),a("option",{key:e.id,value:e.id},u(e.name),9,j))),128))],544),[[m,r.selectedRegion]])]),t("div",null,[B,d(t("select",{id:"location","onUpdate:modelValue":o[2]||(o[2]=e=>r.selectedLocation=e),onChange:o[3]||(o[3]=(...e)=>n.filterData&&n.filterData(...e)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[N,(i(!0),a(g,null,c(r.filteredLocations,e=>(i(),a("option",{key:e.id,value:e.id},u(e.name),9,I))),128))],544),[[m,r.selectedLocation]])])]),t("div",T,[U,d(t("select",{id:"merchant","onUpdate:modelValue":o[4]||(o[4]=e=>r.selectedMerchant=e),onChange:o[5]||(o[5]=(...e)=>n.filterData&&n.filterData(...e)),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[F,(i(!0),a(g,null,c(r.merchants,e=>(i(),a("option",{key:e.id,value:e.id},u(e.name),9,O))),128))],544),[[m,r.selectedMerchant]])]),t("div",null,[H,t("div",q,[z,d(t("input",{type:"date",id:"date","onUpdate:modelValue":o[6]||(o[6]=e=>r.selectedDate=e),onChange:o[7]||(o[7]=(...e)=>n.filterData&&n.filterData(...e)),class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Elige una fecha"},null,544),[[P,r.selectedDate]])])]),t("div",G,[t("button",{onClick:o[8]||(o[8]=(...e)=>n.addNewItem&&n.addNewItem(...e)),class:"bg-green-500 text-white px-2 py-1 rounded-full"},K)])])]),t("div",Q,[k(x,{showModal:r.showModal,onClose:o[9]||(o[9]=e=>r.showModal=!1),onSave:n.handleSaveVisit},null,8,["showModal","onSave"]),W,(i(!0),a(g,null,c(r.merchantProgresses,e=>(i(),p(_,{key:e.merchant_id,merchantProgress:e,date:r.selectedDate},null,8,["merchantProgress","date"]))),128))])]),_:1})}const ne=V(D,[["render",X]]);export{ne as default};
